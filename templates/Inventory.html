{% extends 'base.html' %}

{% block title %}Інвентар DRA{% endblock %}
{% block header_title %}Інвентар{% endblock %}

{% block content %}
<section class="grid">
    <article class="card">
        <h2>Додати предмет</h2>
        <form method="post" class="form" enctype="multipart/form-data">
            <input type="hidden" name="action" value="add">
            <label for="name">Назва</label>
            <input id="name" name="name" type="text" required>

            <label for="item_type">Тип</label>
            <input id="item_type" name="item_type" type="text" required>

            <label for="rarity">Рідкість</label>
            <select id="rarity" name="rarity">
                <option>Звичайний</option>
                <option>Рідкісний</option>
                <option>Епічний</option>
                <option>Легендарний</option>
            </select>

            <div class="form-grid">
                <div>
                    <label for="durability">Міцність</label>
                    <input id="durability" name="durability" type="number" min="0" value="10">
                </div>
                <div>
                    <label for="max_durability">Максимум</label>
                    <input id="max_durability" name="max_durability" type="number" min="1" value="10">
                </div>
            </div>

            {% if is_master and recipients %}
                <label for="target_user_id">Кому видати</label>
                <select id="target_user_id" name="target_user_id">
                    <option value="{{ user.id }}">{{ user.nickname }} (ви)</option>
                    {% for recipient in recipients %}
                        <option value="{{ recipient.id }}">{{ recipient.nickname }}</option>
                    {% endfor %}
                </select>
            {% endif %}

            <label for="description">Опис</label>
            <textarea id="description" name="description" rows="3"></textarea>

            <label for="icon">Іконка</label>
            <input id="icon" name="icon" type="file" accept="image/*">

            <button type="submit" class="button">Додати</button>
        </form>
    </article>

    <article class="card">
        <h2>Ваші предмети</h2>
        {% if items %}
            <div class="inventory-grid">
                {% for item in items %}
                    <div class="inventory-item">
                        <div class="inventory-item__header">
                            {% if item.icon_path %}
                                <img src="{{ url_for('static', filename=static_path(item.icon_path)) }}" alt="{{ item.name }}" class="item-icon">
                            {% else %}
                                <div class="item-icon item-icon--placeholder">?</div>
                            {% endif %}
                            <div>
                                <strong>{{ item.name }}</strong>
                                <p class="muted">{{ item.item_type }} • {{ item.rarity }}</p>
                            </div>
                        </div>
                        <p class="muted">{{ item.description or 'Опис відсутній.' }}</p>
                        <div class="chip-grid">
                            <span class="chip">Міцність: {{ item.durability }}/{{ item.max_durability }}</span>
                        </div>
                        <form method="post" class="form inline">
                            <input type="hidden" name="item_id" value="{{ item.id }}">
                            <button type="submit" name="action" value="use" class="button ghost">Використати</button>
                            <button type="submit" name="action" value="repair" class="button">Полагодити</button>
                            <button type="submit" name="action" value="delete" class="button danger">Видалити</button>
                        </form>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="muted">Поки що інвентар порожній.</p>
        {% endif %}
    </article>
</section>
{% endblock %}
